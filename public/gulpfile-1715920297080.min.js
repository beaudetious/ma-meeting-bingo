const{src,dest,series}=require("gulp"),uglify=require("gulp-uglify"),rename=require("gulp-rename"),replace=require("gulp-replace"),cleanCSS=require("gulp-clean-css"),htmlmin=require("gulp-htmlmin"),merge=require("merge-stream"),date=Date.now();function handleJs(){return src("*.js").pipe(rename({extname:"-"+date+".min.js"})).pipe(uglify()).pipe(dest("./public"))}function handlePages(){return src("./*.html").pipe(replace(/(src="(?!(http)|(\/libraries)).*?)\.js"/g,"$1-"+date+'.min.js"')).pipe(replace(/(href="(?!(http)|(\/libraries)).*?)\.css"/g,"$1-"+date+'.min.css"')).pipe(htmlmin({minifyCSS:!0,minifyJS:!0,removeComments:!0,collapseWhitespace:!0})).pipe(dest("./public/"))}function handleCss(){return src("*.css").pipe(cleanCSS()).pipe(replace(/(@import.*?)\.css'/g,"$1-"+date+".min.css'")).pipe(rename({extname:"-"+date+".min.css"})).pipe(dest("./public/"))}function copy(){return merge([src("./img/**").pipe(dest("./public/img")),src("./ios/**").pipe(dest("./public/ios")),src("./android/**").pipe(dest("./public/android")),src("./screenshots/**").pipe(dest("./public/screenshots")),src("./manifest.json").pipe(dest("./public/manifest.json"))])}exports.default=series(handleJs,handleCss,handlePages,copy);